<HTML>
<head><title>Free energy calculation</title></head>



<style type="text/css">
  div.important {color: #ff0000}
  div.code {
  background: #afd8de;
  border: #000 2px solid;
  padding: 10px;  width: 50%;
  }
</style>


<body BGCOLOR="white">
<!-- <center><h4>http://www.mpibpc.mpg.de/groups/de_groot/compbio2/p8/index.html</h4></center> -->
<p>


<font face="Arial" size="-1">
<a name="contents"></a>  <center><h1>Practical 8: Free energy calculations</h1></center>
<div class="code">

  <font color=black size=5>
    Contents
  </font>
  <UL>
    <font color=black size=3>
      <LI><a href="#fep">   A. The free energy "slow-growth" method </a>
      <LI><a href="#nasolvation"> B. Solvation free energy of a sodium ion in water </a>
      <LI><a href="#references"> References </a>

    </font>
  </UL>
  
</div>
<br>

<a name="fep"></a> <font color=#00c5d0 size=+0>   <h2>A.  The free energy "slow-growth" method</h2> </font>
Molecular simulations can be carried out to gain either dynamical or
energetical information on the simulated system. Today we'll focus on
different ways to extract energies and free energies from simulations.
One way to gain access to free energies by simulation is to perform
so-called free-energy perturbation (FEP) simulations. In such
simulations, the system is gradually "morphed" from one state to
another (let's say from state "A" to state "B"), during which the
effect of this perturbation onto the free energy is monitored. In
practice, this is achieved by defining a morph parameter lambda, which
is defined to be zero in the initial state (A), and one in the final
state (B). By collecting the derivative of the potential energy with
respect to lambda during the simulation, and by integrating over
lambda afterwards, we gain access to the free energy.<p> 
<div align="center"> <IMG   SRC="lambda+eq.png"> </div>
<br>
Go back to <a href="#contents">Contents</a>
<a name="nasolvation"></a> <font color=#00c5d0 size=+0>   <h2>B.  Solvation free energy of a sodium ion in water</h2> </font>
<IMG align=right SRC="na.jpg">
We are now going
to use this procedure to calculate the free energy of solvation for a
sodium ion in water. For this, we'll slowly create a sodium ion in a
water box. In order to start the simulation, download the
<a href=start.pdb> starting coordinates</a>, <a href=na.top> the
topology</a>, and <a href=fep.mdp> the MD parameter file </a> first.
First have a look at the starting structure:
<h5> pymol start.pdb </h5>
In pymol, type:
<h5> show cell </h5>
<h5> show spheres, resn  na </h5>

Note that the sodium ion is already "present" in the starting
structure. Now have a look at the topology "na.top", with 'xedit',
'nedit', 'more' or 'less', and look for the line containing "Na" under
"[atoms]". You'll notice that two states (A and B) are defined, with
charge 0 and 1, respectively. This means that during the simulation,
the charge of the sodium ion will be slowly switched on. <br>
Now start the simulation:
<h5>gmx grompp -f fep -c start.pdb -p na -maxwarn 1 </h5>
<h5>gmx mdrun -v -c charged.gro</h5>

Analyse the free energy change by:
<h5> xmgrace dhdl.xvg </h5>
In order to compute the free energy, we must integrate dG/dlambda over
dlambda. Instead, we have dG/dlambda as a function of time. This is
not a problem, as we know that lambda changed from0 to 1 during this
time (10 ps). So instead, we can integrate the curve over time, and
divide the obtained value by ten to derive the desired free energy.
To integrate, under "Data", select "Transformations", followed by
"Integration", and press "Accept". <br><p>
<font color=red size=+1> Question: </font>
The experimentally observed solvation free energies for sodium range
from -365 to -372 kJ/mol. How does the obtained value correspond to
that?  <br><p>

Instead of integrating dG/dlambda, we can also compare the initial and
final values of the potential energy of the system:
<h5> gmx energy </h5>
Select "Potential", followed by "0" (and, if necessary, an extra "enter").
<h5> xmgrace energy.xvg </h5>
Subtract the initial value from the final value.<br><p>
<font color=red size=+1> Question: </font>
What value do you get? Why is this value so much larger (in absolute
value) than the free energy difference obtained by integrating
dG/dlambda?<br><p> 

One important check in simulations in general and in free energy
simulations in particular is to make sure that the answer has
converged. In order to do so, we can either perform a longer (or
shorter!) simulation, and compare the result to the original, or we
can perform the backward transition to see if the free energy
difference is the opposite of the forward transition. In this
practical, we'll do both. First, we'll carry out the backward
transition. Copy the MD parameter file to incorporate the changes:
<h5> cp fep.mdp back.mdp</h5>
and open "back.mdp" in your favorite editor (xedit, nedit, emacs,
kate, vi)
to make the following changes:<br>
First search for "Free energy", then change "init-lambda" to 1 and
change delta-lambda to "-0.0002". Now we can start the backward
simulation. For this, we'll use the final structure of the previous
simulation (charged.gro) as initial structure:
<h5> gmx grompp -f back -c charged.gro -p na -maxwarn 1 </h5>
<h5> gmx mdrun -v </h5>
And analyse the free energy change using xmgrace. Remember that we now
changed lambda from one to zero, meaning that if we integrate over
time, we should divide the obtained value by -10 instead of by 10.<br><p>
<font color=red size=+1> Question: </font>
What value do you get? How does this value compare to the free energy
change for the forward simulation? Would you consider the obtained
value for the solvation free energy sufficiently converged? <br><p>
<font color=red size=+1> Question: </font>
If we take the forward and backward
simulation together, is the total free energy change positive or
negative? Which of the two should it have been? <br><p>

As stated above, another way to check convergence is to perform a
longer simulation and see if the free energy change remains the same
as compared to a shorter simulation. For this, open "fep.mdp" in your
favorite editor. Change "nsteps" from 5000 to 50000, and
"delta-lambda" from 0.0002 to 0.00002, and repeat the forward
transition:
<h5> gmx grompp -f fep -c start.pdb -p na -maxwarn 1 </h5>
<h5> gmx mdrun -v</h5>

<font color=red size=+1> Question: </font>
Is the obtained free energy very different as compared to the shorter
simulations? What would you consider an appropriate length for this
type of simulation?<p>
<br>
Go back to <a href="#contents">Contents</a>
<a name="references"></a> <font color=#1a83c4 size=+1> <h2>Further references:</h2> </font>
<ul>
<p>
<font color=#1a83c4 size=+1>Books:</font>
<p>
<li> Editors: Chipot C. , Christophe A. et al., <EM> <b> Free Energy Calculations </b> </EM>, Springer Series in Chemical Physics, Vol. 86,  <a href="http://scc.acad.bg/ncsa/articles/library/Library2016_Supercomputers-at-Work/Free_Energy/FreeEnergy_Calculation_Chemistry_and_Biology.pdf"> [link] </a> . 
<p>
<p>
<font color=#1a83c4 size=+1>Advanced reading:</font>
<li>  R. W. Zwanzig, <EM> High Temperature Equation of State by a Perturbation Method. I. Nonpolar Gases</EM> <b> J. Chem. Phys. </b> 22: 1420 (1954). <a href="http://ursula.chem.yale.edu/~batista/classes/vaa/zwanzig1954.pdf"> [link] </a>

<li>  Goette M, Grubmuller H, <EM> Accuracy and convergence of free energy differences calculated from nonequilibrium switching processes. </EM> <b> J. Comp. Chem.  </b> 30: 447-456 (2009). <a href="http://www.mpibpc.mpg.de/275668/Goette_2009_JCC_30_447-457.pdf"> [link] </a>



</ul>

<p>
Go back to <a href="#contents">Contents</a> 

</body> 
</HTML>
